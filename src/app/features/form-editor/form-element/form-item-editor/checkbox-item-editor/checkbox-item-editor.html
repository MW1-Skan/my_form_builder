<div class="d-flex flex-column gap-4">
  <form [formGroup]="extrasEditorForm" class="d-flex flex-column gap-3">
    <div class="d-flex flex-wrap align-items-center gap-4">
      <div class="d-flex align-items-center gap-2">
        <label for="required" class="form-label mb-0 fw-semibold">Required ?</label>
        <p-toggleswitch id="required" formControlName="required" />
      </div>

      @if (maxChecks) {
        <div class="d-flex align-items-center gap-2">
          <label for="force-max" class="form-label mb-0 fw-semibold">Force max checks ?</label>
          <p-toggleswitch id="force-max" formControlName="forceMax" />
        </div>
      }
    </div>

    <div class="d-flex flex-wrap align-items-center gap-2">
      <p-floatlabel variant="on">
        <p-inputnumber
          id="min"
          formControlName="minChecks"
          [min]="1"
          [invalid]="isTouchedOrDirtyAndHasError(extrasEditorForm, 'invalidRange')"
        />
        <label for="min">Minimum checks</label>
      </p-floatlabel>

      <p-floatlabel variant="on">
        <p-inputnumber
          id="max"
          formControlName="maxChecks"
          [invalid]="isTouchedOrDirtyAndHasError(extrasEditorForm, 'invalidRange')"
        />
        <label for="max">Maximum checks</label>
      </p-floatlabel>
    </div>
  </form>

  <form [formGroup]="itemEditorForm()">
    <div formArrayName="options" class="d-flex flex-column gap-3">
      <span class="form-label mb-0 fw-semibold">Options</span>
      @for (option of optionsEditorForm.controls; track $index) {
        <div class="d-flex flex-column gap-1">
          <div [formGroupName]="$index" class="d-flex flex-wrap gap-2 align-items-center">
            <input
              pInputText
              formControlName="label"
              placeholder="Label"
              [invalid]="isTouchedOrDirtyAndHasError(option.controls.label, 'required')"
            />
            <input
              pInputText
              formControlName="value"
              placeholder="Value"
              [invalid]="isTouchedOrDirtyAndHasError(option.controls.value, 'required')"
            />
            @if ($index > 0) {
              <p-button
                (onClick)="removeOption($index)"
                icon="pi pi-minus"
                styleClass="p-button-rounded p-button-sm p-button-secondary"
              />
            }
          </div>
          <app-validation-error-message
            [controls]="[option.controls.label, option.controls.value]"
            errorName="required"
            errorMessage="Please enter a Label and a Value."
          />
        </div>
      }
      <p-button
        label="Add option"
        (onClick)="addOption()"
        icon="pi pi-plus"
        styleClass="p-button-sm p-button-info p-button-rounded"
      />
    </div>
  </form>

  <!-- Validation messages -->
  <div class="d-flex flex-column gap-1">
    <app-validation-error-message
      [controls]="[extrasEditorForm]"
      errorName="invalidRange"
      errorMessage="The maximum has to be greater than the minimum."
    />
    <app-validation-error-message
      [controls]="[extrasEditorForm.controls.minChecks]"
      errorName="minTooBig"
      errorMessage="The minimum has to be smaller than the number of options."
    />
  </div>
</div>
